Hereâ€™s your **final polished PRD** â€” clear, professional, and implementation-ready for your AI wound care agent with model selection. This version integrates **security**, **traceability**, **prompt templating**, and **robust error handling**, so a developer or AI agent can follow it precisely.

---

# ğŸ“ **PRD: AI Wound Care Evaluation + Treatment Plan Generator (with Model Selection)**

## 1ï¸âƒ£ **Overview**

We are building an AI-powered tool to:

* **Analyze uploaded wound photos**
* **Generate customized care plans** for:

  * Family caregivers (lay language, step-by-step)
  * Patients (empowering, clear)
  * Medical professionals (clinical language, protocol-based)
* **Allow model selection**:

  * `gpt-4o`
  * `gpt-3.5`
  * `gpt-3.5-pro`
* **Learn from feedback** via `Agents.md` case log

â¡ **Platform**: Replit (Node.js + TypeScript + optional React)
â¡ **Constraint**: No code file > 300 lines unless unavoidable

---

## 2ï¸âƒ£ **Key Features**

### ğŸš€ Image Upload & Classification

* User uploads photo (JPG/PNG â‰¤10MB) + selects:

  * Audience type: `family` | `patient` | `medical`
  * AI model: `gpt-4o` | `gpt-3.5` | `gpt-3.5-pro`
* Classify wound:

  * Type (e.g. pressure ulcer, diabetic foot ulcer)
  * Stage (if applicable)
  * Size: small | medium | large
  * Bed: necrotic | granulating | sloughy | epithelializing
  * Exudate: none | low | moderate | heavy
  * Infection signs: e.g., erythema, odor

---

### ğŸ’¡ Model Selection

* API dynamically routes to the chosen model
* All completions clearly tagged with model in logs
* Default model: `gpt-4o` if none specified

---

### ğŸ¥ Audience-Specific Care Plan

* Tailored plan per audience type:

  * Clear, step-by-step for family
  * Empowerment + warning signs for patient
  * Protocol-based guidance for professionals
* Includes:

  * Cleaning method
  * Dressing type (generic, no brand names unless configured)
  * Frequency of dressing changes
  * Escalation criteria

---

### ğŸ“ Feedback + Continuous Learning

* `/feedback` endpoint appends to `Agents.md`
* Logs:

  * Case ID
  * Model
  * Plan
  * User feedback
  * Version + prompt snapshot

---

### ğŸ” Security & Privacy

* Images processed in-memory; no image storage unless explicit consent
* API protects against oversized files and unsupported formats
* CORS + basic rate limiting applied

---

## 3ï¸âƒ£ **File Structure**

```
/wound-care-ai
â”œâ”€â”€ /server
â”‚   â”œâ”€â”€ index.ts                # Express server entry point
â”‚   â”œâ”€â”€ imageProcessor.ts        # Validates and processes images
â”‚   â”œâ”€â”€ woundClassifier.ts       # Wound type/stage extractor
â”‚   â”œâ”€â”€ carePlanGenerator.ts     # Generates care plan via AI
â”‚   â”œâ”€â”€ modelRouter.ts           # Routes to correct AI model
â”‚   â”œâ”€â”€ /prompts
â”‚       â””â”€â”€ templates.ts         # Reusable prompt templates
â”‚
â”œâ”€â”€ /client (optional)
â”‚   â””â”€â”€ App.tsx
â”‚
â”œâ”€â”€ Agents.md                    # Case + feedback log
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

âœ… Each file â‰¤300 lines where possible

---

## 4ï¸âƒ£ **API Design**

### `POST /upload`

```json
{
  "audience": "family",
  "model": "gpt-4o",
  "image": "<binary>"
}
```

â¡ Returns:

```json
{
  "caseId": "2025-06-29-001",
  "plan": "...",
  "model": "gpt-4o",
  "version": "v1.0.0"
}
```

---

### `POST /feedback`

```json
{
  "caseId": "2025-06-29-001",
  "feedback": "Family found instructions clear but dressing type unavailable locally."
}
```

â¡ Appends to `Agents.md`.

---

## 5ï¸âƒ£ **Agents.md Format**

```md
## Case: 2025-06-29-001
Model: gpt-4o  
Version: v1.0.0  
Prompt: [prompt text sent to model]  
Wound: Pressure ulcer stage 2, medium, granulating, moderate exudate  
Plan: [care plan text here]  
Feedback: Family found instructions clear but dressing type unavailable locally.
```

---

## 6ï¸âƒ£ **Non-Functional Requirements**

âœ… All AI completions include safety disclaimer:

> *â€œThis is an AI-generated plan. Please consult a healthcare professional before following recommendations.â€*

âœ… Error handling: return clear JSON:

```json
{
  "code": "INVALID_IMAGE",
  "message": "Image must be PNG or JPG and under 10MB."
}
```

âœ… Traceability:

* All plans include version + model info
* Prompt snapshot saved
  âœ… Lightweight analytics: log model + audience usage count

---

## 7ï¸âƒ£ **Stretch Goals**

ğŸŒŸ **Localization**

* Language + region options (future version)

ğŸŒŸ **UI features**

* Drag-drop upload
* Model + audience selectors

ğŸŒŸ **Configurable regional dressing types**

* Allow operator to pre-set available supplies

---

## 8ï¸âƒ£ **Deliverables**

âœ… Working REST API (upload + feedback)
âœ… Model selection + routing
âœ… `Agents.md` updated for each case
âœ… Code â‰¤300 lines per file
âœ… Deployment instructions (README.md)

---

## âœ… Final Notes for Developers

â¡ ModelRouter should cleanly abstract API calls:

```ts
export async function generatePlanWithModel(model: string, prompt: string) {
  if (!["gpt-4o", "gpt-3.5", "gpt-3.5-pro"].includes(model)) {
    throw new Error("Invalid model selection");
  }
  // Call OpenAI API with specified model
}
```

â¡ Prompt templates in `/prompts/templates.ts`
â¡ Plan always logs model + version

---

### Would you like:

* Starter code for any of these modules?
* Draft of the README or API docs?
* Example prompt templates for each audience?

Let me know â€” I can help generate those next! ğŸš€
